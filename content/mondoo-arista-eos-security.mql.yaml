# Copyright (c) Mondoo, Inc.
# SPDX-License-Identifier: BUSL-1.1
policies:
  - uid: mondoo-arista-eos-security
    name: Mondoo Arista EOS Security
    version: 1.0.0
    license: BUSL-1.1
    tags:
      mondoo.com/category: security
      mondoo.com/platform: arista-eos,networkdevice
    require:
      - provider: arista
    authors:
      - name: Mondoo, Inc
        email: hello@mondoo.com
    docs:
      desc: |-
        The Mondoo Arista EOS Security policy provides comprehensive security checks for Arista EOS network switches and routers. This policy helps ensure your Arista network infrastructure is properly configured, hardened, and maintained according to security best practices.

        This policy covers the following critical security areas:

        - **User Account Security**: Validates user authentication, password policies, and privilege management
        - **Authentication & Authorization**: Ensures proper AAA configuration and multifactor authentication
        - **Protocol Security**: Verifies secure protocols are used and insecure protocols are disabled
        - **Interface Management**: Validates interface configurations and security settings
        - **VLAN Security**: Ensures proper VLAN configuration and native VLAN protection
        - **SNMP Hardening**: Validates SNMP configuration security
        - **NTP Synchronization**: Ensures accurate time synchronization for logging and auditing
        - **Logging & Auditing**: Validates comprehensive logging configuration
        - **Access Control**: Ensures proper console and remote access controls
        - **System Hardening**: Validates security banners, timeouts, and system configuration

        ## Join the community!

        Our goal is to build policies that are simple to deploy, accurate, and actionable.

        If you have any suggestions for how to improve this policy, or if you need support, [join the community](https://github.com/orgs/mondoohq/discussions) in GitHub Discussions.

        ## Further information about MQL

        To learn about MQL, Mondoo's graph-based query language, read [Write Effective MQL](https://mondoo.com/docs/mql/mql.write/).
    groups:
      - title: User Account Security
        filters: asset.platform == "arista-eos"
        checks:
          - uid: mondoo-arista-eos-security-no-users-without-password
          - uid: mondoo-arista-eos-security-admin-account-exists
          - uid: mondoo-arista-eos-security-users-with-encrypted-passwords
          - uid: mondoo-arista-eos-security-minimum-privilege-enforcement
          - uid: mondoo-arista-eos-security-password-minimum-length
      - title: Authentication and Authorization (AAA)
        filters: asset.platform == "arista-eos"
        checks:
          - uid: mondoo-arista-eos-security-aaa-authentication-enabled
          - uid: mondoo-arista-eos-security-aaa-authorization-console
          - uid: mondoo-arista-eos-security-aaa-accounting-commands
          - uid: mondoo-arista-eos-security-aaa-accounting-exec
          - uid: mondoo-arista-eos-security-aaa-accounting-system
          - uid: mondoo-arista-eos-security-aaa-authentication-failure-logging
          - uid: mondoo-arista-eos-security-multifactor-authentication
      - title: Protocol Security
        filters: asset.platform == "arista-eos"
        checks:
          - uid: mondoo-arista-eos-security-telnet-disabled
          - uid: mondoo-arista-eos-security-http-disabled
          - uid: mondoo-arista-eos-security-https-enabled
          - uid: mondoo-arista-eos-security-ssh-enabled
      - title: SNMP Security
        filters: asset.platform == "arista-eos"
        checks:
          - uid: mondoo-arista-eos-security-snmp-community-strings-configured
          - uid: mondoo-arista-eos-security-snmp-traps-secured
      - title: NTP and Time Configuration
        filters: asset.platform == "arista-eos"
        checks:
          - uid: mondoo-arista-eos-security-ntp-enabled
          - uid: mondoo-arista-eos-security-timezone-configured
          - uid: mondoo-arista-eos-security-ntp-servers-configured
      - title: Logging and Auditing
        filters: asset.platform == "arista-eos"
        checks:
          - uid: mondoo-arista-eos-security-logging-enabled
          - uid: mondoo-arista-eos-security-logging-level-configured
          - uid: mondoo-arista-eos-security-logging-host-configured
          - uid: mondoo-arista-eos-security-logging-buffered-configured
      - title: VLAN Security
        filters: |
          asset.platform == "arista-eos"
          arista.eos.vlans != empty
        checks:
          - uid: mondoo-arista-eos-security-vlan-names-configured
          - uid: mondoo-arista-eos-security-vlan-trunk-native-not-vlan1
          - uid: mondoo-arista-eos-security-unused-vlan1
      - title: Interface Security
        filters: |
          asset.platform == "arista-eos"
          arista.eos.interfaces != empty
        checks:
          - uid: mondoo-arista-eos-security-interface-descriptions
          - uid: mondoo-arista-eos-security-unused-interfaces-disabled
      - title: Access Control and Banners
        filters: asset.platform == "arista-eos"
        checks:
          - uid: mondoo-arista-eos-security-login-banner-configured
          - uid: mondoo-arista-eos-security-motd-banner-configured
          - uid: mondoo-arista-eos-security-exec-timeout-configured
          - uid: mondoo-arista-eos-security-console-timeout-configured
      - title: System Configuration
        filters: asset.platform == "arista-eos"
        checks:
          - uid: mondoo-arista-eos-security-hostname-configured
          - uid: mondoo-arista-eos-security-domain-name-configured
          - uid: mondoo-arista-eos-security-service-password-encryption
    scoring_system: average
queries:
  - uid: mondoo-arista-eos-security-aaa-accounting-commands
    title: Ensure AAA accounting is enabled for commands
    impact: 90
    mql: |
      arista.eos.runningConfig.content.lines.one(_ == /aaa accounting commands all default start-stop/)
    docs:
      desc: |
        This check verifies that AAA accounting is configured to log all command executions.

        ## Rationale

        Command accounting is essential for security auditing:

        - **Forensic Analysis**: Provides detailed logs of all commands executed on the device
        - **Compliance**: Required by frameworks like DISA STIG, PCI DSS, and HIPAA
        - **Incident Response**: Critical for investigating security incidents
        - **Change Tracking**: Documents who made configuration changes and when
        - **Accountability**: Creates an audit trail for all privileged operations

        Without command accounting, there is no record of what commands administrators executed, making it impossible to track unauthorized changes or investigate incidents.

        ## Remediation

        Enable AAA accounting for all commands:

        ```
        configure
        aaa accounting commands all default start-stop logging
        ```

        Configure syslog server to receive accounting records:

        ```
        logging host <syslog-server-ip>
        ```
  - uid: mondoo-arista-eos-security-aaa-accounting-exec
    title: Ensure AAA accounting is enabled for exec sessions
    impact: 85
    mql: |
      arista.eos.runningConfig.content.lines.one(_ == /aaa accounting exec default start-stop/)
    docs:
      desc: |
        This check verifies that AAA accounting logs exec session start and stop events.

        ## Rationale

        Exec session accounting provides login tracking:

        - **Session Tracking**: Records when users log in and out
        - **Connection Duration**: Tracks how long users were connected
        - **Access Monitoring**: Identifies unusual access patterns
        - **Compliance**: Required for audit and compliance reporting
        - **Forensics**: Critical for investigating unauthorized access

        ## Remediation

        Enable AAA accounting for exec sessions:

        ```
        configure
        aaa accounting exec default start-stop logging
        ```
  - uid: mondoo-arista-eos-security-aaa-accounting-system
    title: Ensure AAA accounting is enabled for system events
    impact: 85
    mql: |
      arista.eos.runningConfig.content.lines.one(_ == /aaa accounting system default start-stop/)
    docs:
      desc: |
        This check verifies that AAA accounting logs system-level events.

        ## Rationale

        System event accounting tracks critical device activities:

        - **Configuration Changes**: Logs system-level configuration modifications
        - **System Events**: Tracks reboots, reloads, and other system events
        - **Compliance**: Required for comprehensive audit trails
        - **Incident Detection**: Helps identify unauthorized system changes

        ## Remediation

        Enable AAA accounting for system events:

        ```
        configure
        aaa accounting system default start-stop logging
        ```
  - uid: mondoo-arista-eos-security-aaa-authentication-enabled
    title: Ensure AAA authentication is enabled
    impact: 95
    mql: |
      arista.eos.runningConfig.content.lines.where(_ == /^aaa authentication/).length > 0
    docs:
      desc: |
        This check verifies that Authentication, Authorization, and Accounting (AAA) is configured on the switch.

        ## Rationale

        AAA is fundamental to network device security:

        - **Centralized Authentication**: Integrates with enterprise identity management systems
        - **Access Control**: Enforces authentication before granting access
        - **Accountability**: Tracks who accessed the device and what they did
        - **Compliance**: Required by most security frameworks and regulations
        - **Scalability**: Centralized user management across multiple devices
        - **Audit Trails**: Comprehensive logging of authentication events

        Without AAA, the switch relies solely on local authentication, which is difficult to manage at scale and provides limited audit capabilities.

        ## Remediation

        Configure AAA authentication for console and remote access:

        ```
        configure
        aaa authentication login default group <radius|tacacs+> local
        aaa authentication login console group <radius|tacacs+> local
        ```

        The `local` fallback ensures access is maintained if AAA servers are unreachable.
  - uid: mondoo-arista-eos-security-aaa-authentication-failure-logging
    title: Ensure authentication failures are logged
    impact: 90
    mql: |
      arista.eos.runningConfig.content.lines.one(_ == "aaa authentication policy on-failure log")
    docs:
      desc: |
        This check verifies that authentication failure events are logged for security monitoring.

        ## Rationale

        Authentication failure logging is critical for security monitoring:

        - **Attack Detection**: Identifies brute-force and password-guessing attacks
        - **Compromised Credentials**: Helps detect attempts to use stolen credentials
        - **Security Monitoring**: Enables real-time alerting on suspicious activity
        - **Forensics**: Provides evidence of attempted unauthorized access
        - **Compliance**: Required by security frameworks for intrusion detection

        Failed login attempts are a primary indicator of attack attempts and should be comprehensively logged.

        ## Remediation

        Enable authentication failure logging:

        ```
        configure
        aaa authentication policy on-failure log
        ```

        Configure log monitoring and alerting for authentication failures:

        ```
        logging host <siem-server-ip>
        ```
  - uid: mondoo-arista-eos-security-aaa-authorization-console
    title: Ensure AAA authorization is enabled for console
    impact: 85
    mql: |
      arista.eos.runningConfig.content.lines.one(_ == "aaa authorization console")
    docs:
      desc: |
        This check verifies that AAA authorization is enabled for console access.

        ## Rationale

        Console authorization ensures proper access control:

        - **Command Authorization**: Controls which commands users can execute
        - **Privilege Enforcement**: Ensures users can only perform authorized operations
        - **Centralized Control**: Manages authorization policies from AAA servers
        - **Compliance**: Required for separation of duties and least-privilege access
        - **Audit Support**: Tracks authorization decisions for compliance reporting

        Without authorization, authenticated users may have unrestricted access to execute any command they choose.

        ## Remediation

        Enable AAA authorization for console access:

        ```
        configure
        aaa authorization console
        aaa authorization commands all default local
        ```
  - uid: mondoo-arista-eos-security-admin-account-exists
    title: Ensure an admin account of last resort exists
    impact: 85
    mql: |
      arista.eos.users.one(
        name == "admin" &&
        format == "sha512" &&
        nopassword == false
      )
    docs:
      desc: |
        This check verifies that an admin account with strong password encryption exists as an account of last resort.

        ## Rationale

        An account of last resort is essential for recovery scenarios:

        - **Authentication Failure Recovery**: Provides access when AAA servers are unavailable
        - **Emergency Access**: Enables critical maintenance during authentication system failures
        - **Business Continuity**: Prevents complete lockout from the device
        - **Strong Encryption**: SHA-512 provides the strongest password protection available on EOS

        The admin account should be protected with SHA-512 encrypted passwords and used only during emergencies.

        ## Remediation

        Configure an admin account with SHA-512 password encryption:

        ```
        configure
        username admin privilege 15 role network-admin secret sha512 <strong-password>
        ```
  - uid: mondoo-arista-eos-security-console-timeout-configured
    title: Ensure console timeout is configured
    impact: 75
    mql: |
      arista.eos.runningConfig.content.lines.one(_ == /absolute-timeout/)
    docs:
      desc: |
        This check verifies that console sessions have a timeout configured.

        ## Rationale

        Console timeouts prevent unauthorized physical access:

        - **Physical Security**: Disconnects idle console sessions
        - **Unauthorized Access**: Prevents access to unattended console
        - **Compliance**: Required for physical access security

        ## Remediation

        Configure absolute timeout for console sessions:

        ```
        configure
        line console
        absolute-timeout 10
        ```
  - uid: mondoo-arista-eos-security-domain-name-configured
    title: Ensure domain name is configured
    impact: 65
    mql: |
      arista.eos.fqdn != arista.eos.hostname
      arista.eos.fqdn.contains(".") == true
    docs:
      desc: |
        This check verifies that a domain name is configured for the device.

        ## Rationale

        Domain name configuration enables important functionality:

        - **FQDN**: Provides fully qualified domain name for the device
        - **SSH Keys**: Required for generating SSH RSA/DSA keys
        - **Certificate Generation**: Needed for SSL/TLS certificate creation
        - **DNS Integration**: Enables proper DNS registration

        ## Remediation

        Configure the IP domain name:

        ```
        configure
        ip domain-name <your-domain.com>
        ```
  - uid: mondoo-arista-eos-security-exec-timeout-configured
    title: Ensure exec timeout is configured
    impact: 75
    mql: |
      arista.eos.runningConfig.content.lines.one(_ == /exec-timeout/)
    docs:
      desc: |
        This check verifies that an exec timeout is configured to automatically disconnect idle sessions.

        ## Rationale

        Session timeouts prevent unauthorized access:

        - **Abandoned Sessions**: Disconnects forgotten sessions
        - **Unauthorized Access**: Prevents access to unattended terminals
        - **Compliance**: Required by security frameworks
        - **Resource Management**: Frees up connection resources

        ## Remediation

        Configure exec timeout (10 minutes recommended):

        ```
        configure
        line vty
        exec-timeout 10
        ```
  - uid: mondoo-arista-eos-security-hostname-configured
    title: Ensure hostname is configured
    impact: 70
    mql: |
      arista.eos.hostname != ""
      arista.eos.hostname.downcase != "switch"
      arista.eos.hostname.downcase != "arista"
    docs:
      desc: |
        This check verifies that a unique, descriptive hostname is configured.

        ## Rationale

        Proper hostname configuration is important for management:

        - **Identification**: Clearly identifies the device in logs and management systems
        - **Logging**: Enables log correlation and analysis
        - **Documentation**: Helps document network topology
        - **Compliance**: Required by security standards

        ## Remediation

        Configure a descriptive, unique hostname:

        ```
        configure
        hostname <unique-descriptive-name>
        ```

        Use naming conventions that include location, function, or other identifying information.
  - uid: mondoo-arista-eos-security-http-disabled
    title: Ensure HTTP API is disabled
    impact: 90
    mql: |
      arista.eos.runningConfig.section(name: "management api http-commands").content.lines.contains("protocol http") == false ||
      arista.eos.runningConfig.content.contains("management api http-commands") == false
    docs:
      desc: |
        This check verifies that the insecure HTTP protocol is disabled for the management API.

        ## Rationale

        HTTP management interfaces are security vulnerabilities:

        - **Unencrypted Traffic**: All API calls and credentials transmitted in clear text
        - **Credential Theft**: Authentication tokens and passwords can be intercepted
        - **Session Hijacking**: Unencrypted sessions can be hijacked by attackers
        - **API Abuse**: Attackers can execute API commands if they intercept credentials
        - **Compliance**: Security standards require encrypted management interfaces

        Only HTTPS should be used for API access to protect credentials and data in transit.

        ## Remediation

        Disable HTTP and enable HTTPS for the management API:

        ```
        configure
        management api http-commands
        no protocol http
        protocol https
        ```
  - uid: mondoo-arista-eos-security-https-enabled
    title: Ensure HTTPS is enabled for management API
    impact: 85
    filters: arista.eos.runningConfig.content.contains("management api http-commands") == true
    mql: |
      arista.eos.runningConfig.section(name: "management api http-commands").content.lines.contains("protocol https") == true
    docs:
      desc: |
        This check verifies that HTTPS is enabled for secure API access.

        ## Rationale

        HTTPS provides essential security for management interfaces:

        - **Encryption**: Protects credentials and data with TLS encryption
        - **Authentication**: Server certificates validate device identity
        - **Integrity**: Prevents tampering with API communications
        - **Compliance**: Required by security standards for management interfaces

        ## Remediation

        Enable HTTPS for the management API:

        ```
        configure
        management api http-commands
        protocol https
        ```
  - uid: mondoo-arista-eos-security-interface-descriptions
    title: Ensure interfaces have descriptions configured
    impact: 60
    filters: arista.eos.interfaces != empty
    mql: |
      arista.eos.interfaces.where(name != /^Management/).all(
        description != "" || interfaceStatus == "disabled"
      )
    docs:
      desc: |
        This check verifies that active interfaces have descriptions configured.

        ## Rationale

        Interface descriptions are important for security and operations:

        - **Documentation**: Clarifies interface purpose and connections
        - **Security**: Helps identify unauthorized connections
        - **Change Management**: Reduces configuration errors
        - **Audit**: Facilitates security audits and compliance reviews
        - **Troubleshooting**: Speeds problem resolution

        ## Remediation

        Configure descriptive names for all interfaces:

        ```
        configure
        interface <interface-name>
        description <purpose and connection details>
        ```

        For example: `description Uplink to Core Switch 1 Gi0/1`
  - uid: mondoo-arista-eos-security-logging-buffered-configured
    title: Ensure buffered logging is configured
    impact: 70
    mql: |
      arista.eos.runningConfig.content.lines.one(_ == /^logging buffered/)
    docs:
      desc: |
        This check verifies that local buffered logging is configured.

        ## Rationale

        Buffered logging provides local log storage:

        - **Immediate Access**: Logs available locally for quick troubleshooting
        - **Backup**: Provides redundancy if remote logging fails
        - **Performance**: Buffer provides efficient log handling

        ## Remediation

        Configure buffered logging with appropriate size:

        ```
        configure
        logging buffered 100000 informational
        ```
  - uid: mondoo-arista-eos-security-logging-enabled
    title: Ensure logging is enabled
    impact: 90
    mql: |
      arista.eos.runningConfig.content.lines.one(_ == "logging on")
    docs:
      desc: |
        This check verifies that system logging is enabled on the switch.

        ## Rationale

        System logging is fundamental to security monitoring:

        - **Security Events**: Logs capture authentication failures, configuration changes, and security events
        - **Incident Response**: Provides data for investigating security incidents
        - **Compliance**: Required by virtually all security frameworks
        - **Troubleshooting**: Essential for diagnosing operational issues
        - **Audit Trails**: Documents all system activities for compliance reporting

        Without logging enabled, security events and configuration changes go unrecorded, making incident detection and investigation impossible.

        ## Remediation

        Enable system logging:

        ```
        configure
        logging on
        ```
  - uid: mondoo-arista-eos-security-logging-host-configured
    title: Ensure remote syslog server is configured
    impact: 90
    mql: |
      arista.eos.runningConfig.content.lines.where(_ == /^logging host/).length > 0
    docs:
      desc: |
        This check verifies that logs are sent to a remote syslog server for centralized management.

        ## Rationale

        Centralized logging is critical for security:

        - **Log Preservation**: Protects logs from local device failure or compromise
        - **Centralized Analysis**: Enables correlation across multiple devices
        - **Security Monitoring**: SIEM systems require remote log collection
        - **Compliance**: Most frameworks require centralized log management
        - **Tamper Protection**: Attackers cannot easily delete logs stored remotely
        - **Capacity**: Remote servers provide unlimited log storage

        ## Remediation

        Configure one or more remote syslog servers:

        ```
        configure
        logging host <syslog-server-ip>
        logging trap informational
        ```
  - uid: mondoo-arista-eos-security-logging-level-configured
    title: Ensure appropriate logging level is configured
    impact: 80
    mql: |
      arista.eos.runningConfig.content.lines.where(_ == /logging level/).length > 0
    docs:
      desc: |
        This check verifies that logging levels are configured for capturing important events.

        ## Rationale

        Proper logging levels ensure important events are captured:

        - **Security Events**: Informational level captures authentication and authorization events
        - **Debug Information**: Higher verbosity aids troubleshooting
        - **Performance**: Appropriate levels balance detail with system performance
        - **Compliance**: Security frameworks specify minimum logging levels

        ## Remediation

        Configure logging levels for important subsystems (informational or debugging):

        ```
        configure
        logging level all informational
        logging level security debugging
        ```
  - uid: mondoo-arista-eos-security-login-banner-configured
    title: Ensure login banner is configured
    impact: 70
    mql: |
      arista.eos.runningConfig.content.lines.where(_ == /^banner login/).length > 0
      arista.eos.runningConfig.content.contains("no banner login") == false
    docs:
      desc: |
        This check verifies that a login banner is configured to display legal notice.

        ## Rationale

        Login banners provide important legal protection:

        - **Legal Notice**: Establishes expectation of privacy and monitoring
        - **Deterrence**: Warns unauthorized users of legal consequences
        - **Compliance**: Required by many security frameworks and regulations
        - **Legal Protection**: Supports prosecution of unauthorized access
        - **Authorization**: Clearly states system is for authorized use only

        ## Remediation

        Configure a login banner with appropriate legal language:

        ```
        configure
        banner login
        UNAUTHORIZED ACCESS TO THIS DEVICE IS PROHIBITED
        You must have explicit, authorized permission to access this device.
        Unauthorized attempts and actions to access or use this system may
        result in civil and/or criminal penalties. All activities performed
        on this device are logged and monitored.
        EOF
        ```
  - uid: mondoo-arista-eos-security-minimum-privilege-enforcement
    title: Ensure users have appropriate privilege levels
    impact: 80
    mql: |
      arista.eos.users.where(name != "admin").all(
        privilege.downcase != "15" || role != ""
      )
    docs:
      desc: |
        This check verifies that non-admin users don't have unrestricted privilege level 15 without role-based access control.

        ## Rationale

        Proper privilege separation is a fundamental security principle:

        - **Least Privilege**: Users should have only the minimum privileges needed for their role
        - **Role-Based Access**: RBAC provides granular control over user permissions
        - **Audit and Accountability**: Clear role assignments improve audit trails
        - **Reduced Risk**: Limiting privileges reduces potential damage from compromised accounts
        - **Compliance**: Many frameworks require privilege separation and least-privilege access

        Privilege level 15 grants full administrative access. Non-admin users with this level should be assigned to specific roles that define their actual permitted operations.

        ## Remediation

        Assign appropriate roles to users instead of granting blanket privilege 15:

        ```
        configure
        username <username> privilege 1 role <appropriate-role>
        ```

        Create custom roles if needed:

        ```
        role <role-name>
           <privilege statements>
        ```
  - uid: mondoo-arista-eos-security-motd-banner-configured
    title: Ensure MOTD banner is configured
    impact: 60
    mql: |
      arista.eos.runningConfig.content.lines.where(_ == /^banner motd/).length > 0
      arista.eos.runningConfig.content.contains("no banner motd") == false
    docs:
      desc: |
        This check verifies that a message-of-the-day (MOTD) banner is configured.

        ## Rationale

        MOTD banners provide system information and warnings:

        - **Security Notices**: Communicates security policies and requirements
        - **System Information**: Provides contact information for support
        - **Maintenance Notices**: Informs users of scheduled maintenance

        ## Remediation

        Configure an MOTD banner:

        ```
        configure
        banner motd
        <your message here>
        EOF
        ```
  - uid: mondoo-arista-eos-security-multifactor-authentication
    title: Ensure multifactor authentication is configured for privileged access
    impact: 90
    mql: |
      arista.eos.runningConfig.content.lines.where(_ == /aaa authentication/).one(_ == /aaa authentication login console group/)
    docs:
      desc: |
        This check verifies that multifactor authentication (MFA) is configured for console access.

        ## Rationale

        Multifactor authentication significantly enhances security:

        - **Credential Protection**: Protects against compromised passwords
        - **Phishing Resistance**: MFA tokens/certificates resist phishing attacks
        - **Compliance**: Required by frameworks like NIST 800-171, PCI DSS v4.0, and Zero Trust
        - **Attack Prevention**: Blocks attackers with stolen passwords
        - **Privileged Access**: Especially critical for administrative accounts

        MFA uses multiple authentication factors: something you know (password), something you have (token/certificate), or something you are (biometric).

        ## Remediation

        Configure console authentication to use RADIUS or TACACS+ with MFA:

        ```
        configure
        aaa authentication login console group radius local
        ```

        Ensure the RADIUS/TACACS+ server is configured for multifactor authentication (e.g., RSA SecurID, Duo Security, or certificate-based authentication).
  - uid: mondoo-arista-eos-security-no-users-without-password
    title: Ensure no user accounts are configured without passwords
    impact: 95
    mql: arista.eos.users.where(nopassword == true) == []
    docs:
      desc: |
        This check verifies that all user accounts on the Arista switch have password protection enabled.

        ## Rationale

        User accounts without password protection represent critical security vulnerabilities:

        - **Unauthorized Access**: Anyone can log in to accounts without passwords
        - **Privilege Escalation**: Password-less accounts can be exploited to gain elevated privileges
        - **Compliance Violations**: Security standards require password protection for all accounts
        - **Audit Trail**: Password-less accounts compromise accountability and audit capabilities
        - **Attack Surface**: These accounts are prime targets for attackers and automated attacks

        All user accounts should require strong password authentication to ensure only authorized personnel can access the device.

        ## Remediation

        Remove the `nopassword` configuration from all user accounts:

        ```
        configure
        no username <username> nopassword
        username <username> secret <strong-password>
        ```

        Ensure all accounts use strong, encrypted passwords (preferably SHA-512).
  - uid: mondoo-arista-eos-security-ntp-enabled
    title: Ensure NTP synchronization is enabled
    impact: 85
    mql: arista.eos.ntp.status != "disabled"
    docs:
      desc: |
        This check verifies that NTP time synchronization is enabled and operational.

        ## Rationale

        Accurate time synchronization is critical for security and operations:

        - **Log Correlation**: Accurate timestamps enable correlation of events across devices
        - **Forensic Analysis**: Consistent time is essential for incident investigation
        - **Compliance**: Many frameworks require accurate time synchronization
        - **Certificate Validation**: TLS/SSL certificates require accurate time for validation
        - **Authentication**: Time-based authentication protocols (Kerberos) require synchronized clocks
        - **Audit Trails**: Inaccurate time undermines audit log reliability

        ## Remediation

        Configure NTP servers for time synchronization:

        ```
        configure
        ntp server <ntp-server-1>
        ntp server <ntp-server-2>
        ```

        Use multiple NTP servers for redundancy.
  - uid: mondoo-arista-eos-security-ntp-servers-configured
    title: Ensure NTP servers are configured
    impact: 85
    mql: |
      arista.eos.runningConfig.content.lines.where(_ == /^ntp server/).length > 0
    docs:
      desc: |
        This check verifies that NTP servers are configured for time synchronization.

        ## Rationale

        Configured NTP servers ensure reliable time synchronization:

        - **Redundancy**: Multiple servers provide failover capability
        - **Reliability**: Ensures time remains accurate even if one server fails
        - **Security**: Use authenticated, trusted NTP sources
        - **Compliance**: Required for accurate audit logging

        ## Remediation

        Configure at least two NTP servers for redundancy:

        ```
        configure
        ntp server <primary-ntp-server>
        ntp server <secondary-ntp-server>
        ```

        Use NTP servers from reliable sources (e.g., NIST, internal stratum 1/2 servers).
  - uid: mondoo-arista-eos-security-password-minimum-length
    title: Ensure password minimum length is configured
    impact: 85
    mql: |
      arista.eos.runningConfig.content.contains("no password minimum length") == false
      arista.eos.runningConfig.content.contains("password minimum length") == true
    docs:
      desc: |
        This check verifies that a minimum password length policy is configured on the switch.

        ## Rationale

        Password length is a critical factor in password strength:

        - **Brute Force Resistance**: Longer passwords exponentially increase cracking time
        - **Complexity**: Length provides more combinations than character variety alone
        - **Industry Standards**: Most security frameworks require minimum password lengths
        - **NIST Guidelines**: Current NIST recommendations emphasize password length over complexity
        - **Attack Protection**: Protects against dictionary and brute-force attacks

        A minimum password length of 15 characters is recommended for administrative accounts. Even a minimum of 12 characters provides substantial security improvements.

        ## Remediation

        Configure a minimum password length (15 characters recommended for high security):

        ```
        configure
        management security
        password minimum length 15
        ```

        For environments requiring compliance with specific standards (e.g., DISA STIG), 15 characters is mandatory.
  - uid: mondoo-arista-eos-security-service-password-encryption
    title: Ensure password encryption service is enabled
    impact: 80
    mql: |
      arista.eos.runningConfig.content.lines.one(_ == "service password-encryption")
    docs:
      desc: |
        This check verifies that password encryption service is enabled to protect passwords in configuration.

        ## Rationale

        Password encryption protects credentials in configuration files:

        - **Configuration Security**: Encrypts clear-text passwords in configuration
        - **Backup Protection**: Protects passwords in configuration backups
        - **Compliance**: Required by security standards
        - **Defense in Depth**: Additional layer of credential protection

        Note: Service password encryption uses weak encryption (Type 7) that can be easily reversed, but it prevents casual observation of passwords. Use stronger password hashing (SHA-512) for user passwords.

        ## Remediation

        Enable service password encryption:

        ```
        configure
        service password-encryption
        ```

        This encrypts passwords that would otherwise be stored in plain text in the configuration.
  - uid: mondoo-arista-eos-security-snmp-community-strings-configured
    title: Ensure SNMP community strings are not using defaults
    impact: 85
    mql: |
      arista.eos.runningConfig.content.contains("snmp-server community public") == false
      arista.eos.runningConfig.content.contains("snmp-server community private") == false
    docs:
      desc: |
        This check verifies that default SNMP community strings (public/private) are not configured.

        ## Rationale

        Default SNMP community strings are well-known security vulnerabilities:

        - **Unauthorized Access**: Default strings are publicly known and commonly exploited
        - **Information Disclosure**: Attackers can query device information using default strings
        - **Network Mapping**: Default SNMP access enables network reconnaissance
        - **Configuration Exposure**: SNMP write access with defaults allows configuration changes
        - **Compliance**: Security standards prohibit default credentials of any kind

        SNMP community strings should be treated like passwords and must be changed from defaults.

        ## Remediation

        Remove default community strings and configure secure, unique strings:

        ```
        configure
        no snmp-server community public
        no snmp-server community private
        snmp-server community <strong-unique-string> ro
        ```

        Consider using SNMPv3 with authentication and encryption instead of community strings:

        ```
        snmp-server user <username> <group> v3 auth sha <password> priv aes128 <privpassword>
        ```
  - uid: mondoo-arista-eos-security-snmp-traps-secured
    title: Ensure SNMP traps are properly secured
    impact: 70
    filters: arista.eos.snmp.enabled == true
    mql: |
      arista.eos.snmp.notifications.all(
        _['enabled'] == false || _['name'] != /public|private/
      )
    docs:
      desc: |
        This check verifies that SNMP trap notifications don't use default community strings.

        ## Rationale

        SNMP traps can expose sensitive information:

        - **Network Events**: Traps reveal device status and network topology
        - **Security Events**: May disclose security-relevant information
        - **Default Strings**: Using default community strings in traps compromises security

        ## Remediation

        Configure SNMP traps with secure community strings:

        ```
        configure
        snmp-server host <server-ip> version 2c <secure-community-string>
        ```
  - uid: mondoo-arista-eos-security-ssh-enabled
    title: Ensure SSH is enabled for secure management
    impact: 90
    mql: |
      arista.eos.runningConfig.content.contains("management ssh") == true
      arista.eos.runningConfig.section(name: "management ssh").content.lines.contains("shutdown") == false
    docs:
      desc: |
        This check verifies that SSH is enabled for secure remote management access.

        ## Rationale

        SSH is the secure standard for remote device management:

        - **Encryption**: All traffic including credentials is encrypted
        - **Authentication**: Supports strong authentication methods including public key
        - **Integrity**: Prevents tampering with management sessions
        - **Industry Standard**: Universally accepted as the secure management protocol
        - **Compliance**: Required by all major security frameworks

        ## Remediation

        Enable SSH management access:

        ```
        configure
        management ssh
        no shutdown
        ```

        Configure SSH server settings for enhanced security:

        ```
        ip ssh version 2
        ```
  - uid: mondoo-arista-eos-security-telnet-disabled
    title: Ensure Telnet is disabled
    impact: 95
    mql: |
      arista.eos.runningConfig.section(name: "management telnet").content.lines.contains("shutdown") == true ||
      arista.eos.runningConfig.content.contains("management telnet") == false
    docs:
      desc: |
        This check verifies that the insecure Telnet protocol is disabled on the switch.

        ## Rationale

        Telnet is inherently insecure and must be disabled:

        - **Plaintext Transmission**: All data including passwords sent in clear text
        - **Credential Exposure**: Passwords can be captured by network sniffers
        - **Man-in-the-Middle**: No encryption allows traffic interception and modification
        - **Compliance**: Prohibited by virtually all security frameworks
        - **Modern Alternatives**: SSH provides secure encrypted replacement

        Telnet should never be used for network device management. Any credential transmitted via Telnet should be considered compromised.

        ## Remediation

        Disable Telnet management access:

        ```
        configure
        management telnet
        shutdown
        ```

        Ensure SSH is enabled as a secure alternative:

        ```
        management ssh
        no shutdown
        ```
  - uid: mondoo-arista-eos-security-timezone-configured
    title: Ensure timezone is configured to UTC or GMT
    impact: 75
    mql: |
      arista.eos.runningConfig.content.lines.one(_ == /clock timezone (UTC|GMT)/)
    docs:
      desc: |
        This check verifies that the system timezone is set to UTC or GMT for consistent logging.

        ## Rationale

        Standardized timezone configuration is essential:

        - **Log Correlation**: UTC provides a common time reference across global infrastructure
        - **Forensic Analysis**: Simplifies analysis of multi-device incidents
        - **Compliance**: Many frameworks require UTC/GMT for audit logs
        - **Best Practice**: Industry standard for infrastructure logging

        ## Remediation

        Configure the timezone to UTC or GMT:

        ```
        configure
        clock timezone UTC
        ```
  - uid: mondoo-arista-eos-security-unused-interfaces-disabled
    title: Ensure unused interfaces are administratively disabled
    impact: 80
    filters: arista.eos.interfaces != empty
    mql: |
      arista.eos.interfaces.where(
        interfaceStatus == "notconnect" &&
        description == "" &&
        name != /^Management/
      ).all(interfaceStatus == "disabled")
    docs:
      desc: |
        This check identifies interfaces that are not connected, have no description, and should be disabled.

        ## Rationale

        Disabling unused interfaces prevents unauthorized access:

        - **Rogue Devices**: Prevents connection of unauthorized devices
        - **Attack Surface**: Reduces potential entry points for attackers
        - **Physical Security**: Limits plug-and-play attacks
        - **Compliance**: Many frameworks require disabling unused ports

        ## Remediation

        Disable unused interfaces:

        ```
        configure
        interface <interface-name>
        shutdown
        ```

        For interfaces that may be used in the future, add a description noting their intended purpose.
  - uid: mondoo-arista-eos-security-unused-vlan1
    title: Ensure VLAN 1 is not used for user traffic
    impact: 75
    filters: arista.eos.vlans != empty
    mql: |
      arista.eos.switchports.where(mode == "access").all(accessVlan != "1")
    docs:
      desc: |
        This check verifies that no access ports are assigned to VLAN 1.

        ## Rationale

        VLAN 1 should be reserved for management only:

        - **Security Isolation**: Separates user traffic from management traffic
        - **Attack Prevention**: Reduces exposure to VLAN hopping attacks
        - **Best Practice**: Industry standard to avoid VLAN 1 for user traffic

        ## Remediation

        Move all access ports from VLAN 1 to appropriate user VLANs:

        ```
        configure
        interface <interface>
        switchport access vlan <appropriate-vlan>
        ```
  - uid: mondoo-arista-eos-security-users-with-encrypted-passwords
    title: Ensure all user passwords are encrypted with strong algorithms
    impact: 90
    mql: |
      arista.eos.users.where(secret != "").all(
        format == "sha512" || format == "sha256"
      )
    docs:
      desc: |
        This check verifies that all user accounts use strong password encryption algorithms (SHA-512 or SHA-256).

        ## Rationale

        Strong password encryption is critical for protecting credentials:

        - **Cryptographic Strength**: SHA-512 and SHA-256 are cryptographically secure hash algorithms
        - **Resistance to Attacks**: Modern algorithms resist rainbow table and brute-force attacks
        - **Compliance**: Security standards require strong cryptographic algorithms
        - **Protection from Exposure**: Encrypted passwords in configuration backups are protected
        - **Deprecated Algorithms**: MD5 and plain text passwords are vulnerable to compromise

        Weak password encryption algorithms (MD5, plain text) should be avoided as they can be easily cracked if configuration files are compromised.

        ## Remediation

        Update all user accounts to use SHA-512 password encryption:

        ```
        configure
        username <username> secret sha512 <password>
        ```

        SHA-512 is preferred over SHA-256 for maximum security.
  - uid: mondoo-arista-eos-security-vlan-names-configured
    title: Ensure VLANs have descriptive names configured
    impact: 60
    filters: arista.eos.vlans != empty
    mql: |
      arista.eos.vlans.where(name.downcase != /^vlan/).length > 0
    docs:
      desc: |
        This check verifies that VLANs have descriptive names rather than default names.

        ## Rationale

        Descriptive VLAN names improve network management:

        - **Documentation**: Names clarify VLAN purpose and usage
        - **Security**: Helps identify unauthorized or misconfigured VLANs
        - **Troubleshooting**: Simplifies network issue diagnosis
        - **Change Management**: Reduces configuration errors

        ## Remediation

        Configure descriptive names for all VLANs:

        ```
        configure
        vlan <vlan-id>
        name <descriptive-name>
        ```

        For example: `name GUEST_WIFI`, `name PROD_SERVERS`, `name MGMT_NETWORK`
  - uid: mondoo-arista-eos-security-vlan-trunk-native-not-vlan1
    title: Ensure trunk ports do not use VLAN 1 as native VLAN
    impact: 85
    filters: arista.eos.switchports != empty
    mql: |
      arista.eos.switchports.where(mode == "trunk").all(
        trunkNativeVlan != "1" && trunkNativeVlan != ""
      )
    docs:
      desc: |
        This check verifies that trunk ports use a native VLAN other than VLAN 1.

        ## Rationale

        VLAN 1 as native VLAN creates security risks:

        - **VLAN Hopping**: Attackers can exploit native VLAN 1 for VLAN hopping attacks
        - **Spanning Tree**: VLAN 1 carries control plane traffic by default
        - **Best Practice**: Security standards recommend avoiding VLAN 1 for user traffic
        - **Attack Surface**: VLAN 1 is a common attack target due to its default status

        ## Remediation

        Configure a dedicated native VLAN (other than 1) for trunk ports:

        ```
        configure
        interface <interface>
        switchport trunk native vlan <vlan-id>
        ```

        Consider using an unused VLAN as the native VLAN and don't assign any access ports to it.
