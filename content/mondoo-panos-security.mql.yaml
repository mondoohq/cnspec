# Copyright (c) Mondoo, Inc.
# SPDX-License-Identifier: BUSL-1.1
policies:
  - uid: mondoo-panos-security
    name: Palo Alto Networks PAN-OS Security by Mondoo
    version: 1.0.0
    license: BUSL-1.1
    tags:
      mondoo.com/category: security
      mondoo.com/platform: panos,networkdevice
    require:
      - provider: panos
    authors:
      - name: Mondoo, Inc
        email: hello@mondoo.com
    docs:
      desc: |-
        The Palo Alto Networks PAN-OS Security by Mondoo policy provides comprehensive security checks for Palo Alto Networks PAN-OS firewalls and Panorama management platforms. This policy helps ensure your network security infrastructure is properly configured, licensed, and maintained according to security best practices.

        This policy covers the following critical security areas:

        - **License Management**: Verifies critical security subscriptions are active and not expired
        - **System Configuration**: Validates operational mode and system parameters

        ## Join the community!

        Our goal is to build policies that are simple to deploy, accurate, and actionable.

        If you have any suggestions for how to improve this policy, or if you need support, [join the community](https://github.com/orgs/mondoohq/discussions) in GitHub Discussions.

        ## Further information about MQL

        To learn about MQL, Mondoo's graph-based query language, read [Write Effective MQL](https://mondoo.com/docs/mql/mql.write/).
    groups:
      - title: System Configuration
        filters: asset.platform == "panos"
        checks:
          - uid: mondoo-panos-security-operational-mode-normal
      - title: Software and Content Versions
        filters: asset.platform == "panos"
        checks:
          - uid: mondoo-panos-security-threat-content-installed
          - uid: mondoo-panos-security-antivirus-content-installed
          - uid: mondoo-panos-security-wildfire-content-installed
          - uid: mondoo-panos-security-app-content-installed
      - title: License Management
        filters: asset.platform == "panos"
        checks:
          - uid: mondoo-panos-security-no-expired-licenses
          - uid: mondoo-panos-security-threat-prevention-license
          - uid: mondoo-panos-security-wildfire-license
          - uid: mondoo-panos-security-url-filtering-license
          - uid: mondoo-panos-security-dns-security-license
queries:
  - uid: mondoo-panos-security-antivirus-content-installed
    title: Ensure antivirus content version is installed
    impact: 85
    mql: panos.system.avVersion != ""
    docs:
      desc: |
        This check verifies that antivirus content is installed on the device.

        ## Rationale

        Antivirus content provides:

        - **Malware Detection**: Signatures for identifying known malware, viruses, and trojans
        - **File-Based Threats**: Protection against malicious files traversing the network
        - **Email Protection**: Scanning of email attachments and content
        - **Web Downloads**: Inspection of downloaded files for malware

        Without antivirus content, malware can traverse the network undetected, potentially infecting endpoints and servers.
  - uid: mondoo-panos-security-app-content-installed
    title: Ensure application content version is installed
    impact: 75
    mql: panos.system.appVersion != ""
    docs:
      desc: |
        This check verifies that application identification content (App-ID) is installed on the device.

        ## Rationale

        Application content enables:

        - **Application Visibility**: Identification of applications regardless of port or protocol
        - **Security Policy Enforcement**: Application-based security rules rather than just port-based
        - **Bandwidth Management**: Application-level QoS and traffic shaping
        - **Risk Assessment**: Understanding what applications are running on the network

        Without current application content, the firewall cannot accurately identify applications, reducing policy effectiveness and network visibility.
  - uid: mondoo-panos-security-dns-security-license
    title: Ensure DNS Security license is active
    impact: 75
    filters: panos.licenses != empty
    mql: |
      panos.licenses.
        where(feature.downcase.contains("dns") && expired == "no").
        length > 0
    docs:
      desc: |-
        This check verifies that an active DNS Security license is installed on the device.

        ## Rationale

        The DNS Security license provides DNS-layer protection:

        - **Malware C2 Blocking**: Prevention of DNS queries to known command-and-control servers
        - **DNS Tunneling Detection**: Identification of data exfiltration through DNS
        - **DGA Protection**: Detection of domain generation algorithm patterns
        - **Real-Time Analysis**: Machine learning-powered DNS traffic analysis
        - **Threat Intelligence**: DNS-based threat intelligence from WildFire

        DNS Security provides an additional layer of protection by analyzing DNS traffic for malicious activity, catching threats that might bypass other security controls.

        ## Remediation

        Purchase and activate a DNS Security license for enhanced DNS-layer threat prevention. This is increasingly important as attackers leverage DNS for command-and-control and data exfiltration.
  - uid: mondoo-panos-security-no-expired-licenses
    title: Ensure no licenses are expired
    impact: 90
    mql: panos.licenses.where(expired == "yes") == []
    docs:
      desc: |
        This check verifies that no licenses on the PAN-OS device are expired.

        ## Rationale

        Expired licenses create security gaps:

        - **No Content Updates**: Expired subscriptions stop receiving threat intelligence and signature updates
        - **Feature Degradation**: Advanced security features may be disabled or operate in limited mode
        - **Compliance Issues**: Many compliance frameworks require active security subscriptions
        - **Reduced Protection**: The device cannot protect against new threats discovered after license expiration

        Organizations must maintain active licenses to ensure continuous protection against evolving threats.

        ## Remediation

        Renew expired licenses through your Palo Alto Networks account or authorized partner:

        1. Log into the [Customer Support Portal](https://support.paloaltonetworks.com)
        2. Navigate to Assets â†’ Devices
        3. Select the device with expired licenses
        4. Renew required subscriptions
        5. Activate licenses on the device
  - uid: mondoo-panos-security-operational-mode-normal
    title: Ensure device operational mode is normal
    impact: 100
    mql: |
      panos.system.operationalMode == "normal" ||
      panos.system.operationalMode == "Normal"
    docs:
      desc: |
        This check verifies that the PAN-OS device is operating in normal mode rather than maintenance or other non-operational states.

        ## Rationale

        A device not in normal operational mode may indicate:

        - **Degraded Security Posture**: The device may not be processing traffic or enforcing security policies
        - **Service Interruption**: Network traffic may not be protected or may be blocked
        - **Configuration Issues**: The device may be in maintenance mode due to configuration problems
        - **Hardware Failures**: Non-normal modes can indicate underlying hardware issues

        Devices should operate in normal mode to provide continuous security protection for network traffic.
  - uid: mondoo-panos-security-threat-content-installed
    title: Ensure threat content version is installed
    impact: 85
    mql: panos.system.threatVersion != ""
    docs:
      desc: |
        This check verifies that threat prevention content is installed on the device.

        ## Rationale

        Threat prevention content provides critical intelligence for:

        - **Threat Detection**: Signatures and intelligence for identifying known threats
        - **IPS Protection**: Intrusion prevention system rules to block attacks
        - **Vulnerability Protection**: Defense against known exploits and attack techniques
        - **Zero-Day Protection**: Behavioral analysis and heuristics for unknown threats

        Without current threat content, the firewall cannot identify or block known threats, leaving the network vulnerable to attacks.
  - uid: mondoo-panos-security-threat-prevention-license
    title: Ensure Threat Prevention license is active
    impact: 95
    filters: panos.licenses != empty
    mql: |
      panos.licenses.
        where(feature.downcase.contains("threat") && expired == "no").
        length > 0
    docs:
      desc: |
        This check verifies that an active Threat Prevention license is installed on the device.

        ## Rationale

        The Threat Prevention license is essential for core security capabilities:

        - **IPS/IDS**: Intrusion prevention and detection system capabilities
        - **Anti-Spyware**: Protection against spyware, command-and-control traffic, and data exfiltration
        - **Vulnerability Protection**: Defense against known software vulnerabilities
        - **Signature Updates**: Regular updates to threat detection signatures

        Without an active Threat Prevention subscription, the firewall operates in a significantly degraded security state and cannot protect against the vast majority of network threats.

        ## Remediation

        Purchase and activate a Threat Prevention license for the device. This is considered a core security subscription and should be maintained on all production firewalls.
  - uid: mondoo-panos-security-url-filtering-license
    title: Ensure URL Filtering license is active
    impact: 80
    filters: panos.licenses != empty
    mql: |
      panos.licenses.
        where(feature.downcase.contains("url") && expired == "no").
        length > 0
    docs:
      desc: |
        This check verifies that an active URL Filtering license is installed on the device.

        ## Rationale

        The URL Filtering license provides web security capabilities:

        - **Malicious Site Blocking**: Prevention of access to known malicious websites
        - **Category-Based Control**: Blocking or allowing websites based on content categories
        - **Phishing Protection**: Detection and blocking of phishing sites
        - **Real-Time Updates**: Continuous updates to URL categorization database
        - **Reputation Scoring**: Risk-based website reputation information

        URL Filtering is essential for protecting users from web-based threats, enforcing acceptable use policies, and preventing phishing attacks.

        ## Remediation

        Purchase and activate a URL Filtering license. This subscription is recommended for environments where users access the internet through the firewall.
  - uid: mondoo-panos-security-wildfire-content-installed
    title: Ensure WildFire content version is installed
    impact: 80
    mql: panos.system.wildfireVersion != ""
    docs:
      desc: |
        This check verifies that WildFire threat intelligence content is installed on the device.

        ## Rationale

        WildFire provides advanced threat prevention through:

        - **Unknown File Analysis**: Cloud-based analysis of unknown files in a sandbox environment
        - **Zero-Day Protection**: Detection and prevention of previously unknown malware
        - **Rapid Updates**: Near real-time signature updates based on global threat intelligence
        - **APT Detection**: Advanced persistent threat identification

        WildFire content ensures the firewall can leverage cloud-based threat intelligence to prevent sophisticated attacks.
  - uid: mondoo-panos-security-wildfire-license
    title: Ensure WildFire license is active
    impact: 85
    filters: panos.licenses != empty
    mql: |
      panos.licenses.
        where(feature.downcase.contains("wildfire") && expired == "no").
        length > 0
    docs:
      desc: |
        This check verifies that an active WildFire license is installed on the device.

        ## Rationale

        The WildFire license provides advanced threat prevention:

        - **Zero-Day Protection**: Detection and prevention of previously unknown malware
        - **Sandbox Analysis**: Cloud-based file analysis in multiple virtual environments
        - **Machine Learning**: Advanced analytics for threat detection
        - **Global Intelligence**: Threat intelligence derived from millions of sensors worldwide

        WildFire is critical for protecting against sophisticated, targeted attacks and zero-day exploits that traditional signature-based detection cannot identify.

        ## Remediation

        Purchase and activate a WildFire license for enhanced zero-day protection. This is strongly recommended for all production firewalls, especially those protecting sensitive environments.
