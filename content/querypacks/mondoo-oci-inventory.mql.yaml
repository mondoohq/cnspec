# Copyright (c) Mondoo, Inc.
# SPDX-License-Identifier: BUSL-1.1

packs:
  - uid: mondoo-asset-inventory-oci
    name: OCI Asset Inventory Pack
    version: 1.0.0
    license: BUSL-1.1
    require:
      - provider: oci
    authors:
      - name: Mondoo, Inc
        email: hello@mondoo.com
    tags:
      mondoo.com/platform: oci,cloud
      mondoo.com/category: best-practices
    summary: Inventory OCI tenancies, compute, networking, and storage
    docs:
      desc: |
        The OCI Asset Inventory Pack by Mondoo retrieves information about Oracle Cloud Infrastructure (OCI) tenancies for asset inventory. It covers identity and access management, compute instances, networking, and object storage.

        ## Authentication

        Scanning OCI requires API key authentication configured in your OCI CLI config file (`~/.oci/config`).

        ## Scan an OCI tenancy

        ```bash
        cnspec scan oci
        ```
    groups:
      - uid: mondoo-asset-inventory-oci-general-group
        title: OCI General
        filters: asset.runtime == "oci"
        queries:
          - uid: mondoo-asset-inventory-oci-tenancy-info
          - uid: mondoo-asset-inventory-oci-regions
          - uid: mondoo-asset-inventory-oci-compartments
      - uid: mondoo-asset-inventory-oci-iam-group
        title: Identity and Access Management
        filters: asset.runtime == "oci"
        queries:
          - uid: mondoo-asset-inventory-oci-iam-users
          - uid: mondoo-asset-inventory-oci-iam-groups
          - uid: mondoo-asset-inventory-oci-iam-policies
      - uid: mondoo-asset-inventory-oci-compute-group
        title: Compute
        filters: asset.runtime == "oci"
        queries:
          - uid: mondoo-asset-inventory-oci-compute-instances
          - uid: mondoo-asset-inventory-oci-compute-images
      - uid: mondoo-asset-inventory-oci-object-storage-group
        title: Object Storage
        filters: asset.runtime == "oci"
        queries:
          - uid: mondoo-asset-inventory-oci-object-storage-namespace
          - uid: mondoo-asset-inventory-oci-object-storage-buckets
      - uid: mondoo-asset-inventory-oci-network-group
        title: Networking
        filters: asset.runtime == "oci"
        queries:
          - uid: mondoo-asset-inventory-oci-network-vcns
          - uid: mondoo-asset-inventory-oci-network-security-lists

queries:
  # --- General ---
  - uid: mondoo-asset-inventory-oci-tenancy-info
    title: OCI tenancy information
    filters: asset.platform == "oci"
    docs:
      desc: |
        Returns basic OCI tenancy information including name, ID, and description.
    mql: |
      oci.tenancy {
        id
        name
        description
      }

  - uid: mondoo-asset-inventory-oci-regions
    title: OCI subscribed regions
    filters: asset.platform == "oci"
    docs:
      desc: |
        Returns all regions the tenancy is subscribed to with their status and home region indicator.
    mql: |
      oci.regions {
        id
        name
        isHomeRegion
        status
      }

  - uid: mondoo-asset-inventory-oci-compartments
    title: OCI compartments
    filters: asset.platform == "oci"
    docs:
      desc: |
        Returns all compartments in the tenancy for understanding the organizational structure.
    mql: |
      oci.compartments {
        id
        name
        description
        state
      }

  # --- Identity and Access Management ---
  - uid: mondoo-asset-inventory-oci-iam-users
    title: IAM users
    filters: asset.platform == "oci"
    docs:
      desc: |
        Returns all IAM users in the tenancy with their state, MFA status, and email verification.
    mql: |
      oci.identity.users {
        id
        name
        email
        emailVerified
        state
        mfaActivated
        created
        lastLogin
        capabilities
      }

  - uid: mondoo-asset-inventory-oci-iam-groups
    title: IAM groups
    filters: asset.platform == "oci"
    docs:
      desc: |
        Returns all IAM groups in the tenancy.
    mql: |
      oci.identity.groups {
        id
        name
        description
        state
        created
      }

  - uid: mondoo-asset-inventory-oci-iam-policies
    title: IAM policies
    filters: asset.platform == "oci"
    docs:
      desc: |
        Returns all IAM policies in the tenancy with their permission statements.
    mql: |
      oci.identity.policies {
        id
        name
        description
        state
        statements
      }

  # --- Compute ---
  - uid: mondoo-asset-inventory-oci-compute-instances
    title: Compute instances
    filters: asset.platform == "oci"
    docs:
      desc: |
        Returns all compute instances with their shape, state, and availability domain.
    mql: |
      oci.compute.instances {
        id
        name
        state
        shape
        availabilityDomain
        faultDomain
        created
        freeformTags
      }

  - uid: mondoo-asset-inventory-oci-compute-images
    title: Compute images
    filters: asset.platform == "oci"
    docs:
      desc: |
        Returns all compute images available in the tenancy.
    mql: |
      oci.compute.images {
        id
        name
        state
        operatingSystem
        operatingSystemVersion
        sizeInMBs
        created
      }

  # --- Object Storage ---
  - uid: mondoo-asset-inventory-oci-object-storage-namespace
    title: Object Storage namespace
    filters: asset.platform == "oci"
    docs:
      desc: |
        Returns the Object Storage namespace for the tenancy.
    mql: |
      oci.objectStorage.namespace

  - uid: mondoo-asset-inventory-oci-object-storage-buckets
    title: Object Storage buckets
    filters: asset.platform == "oci"
    docs:
      desc: |
        Returns all Object Storage buckets with their access, versioning, and encryption configuration.
    mql: |
      oci.objectStorage.buckets {
        name
        id
        publicAccessType
        storageTier
        versioning
        objectEventsEnabled
        replicationEnabled
        isReadOnly
        kmsKeyId
        approximateCount
        approximateSize
        created
      }

  # --- Networking ---
  - uid: mondoo-asset-inventory-oci-network-vcns
    title: Virtual Cloud Networks
    filters: asset.platform == "oci"
    docs:
      desc: |
        Returns all VCNs with their CIDR blocks and DNS configuration.
    mql: |
      oci.network.vcns {
        id
        name
        state
        cidrBlocks
        dnsLabel
        vcnDomainName
        created
      }

  - uid: mondoo-asset-inventory-oci-network-security-lists
    title: VCN security lists
    filters: asset.platform == "oci"
    docs:
      desc: |
        Returns all VCN security lists with their ingress and egress rules.
    mql: |
      oci.network.securityLists {
        id
        name
        state
        vcnId
        ingressSecurityRules
        egressSecurityRules
        created
      }
